<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>torypto kripto sinyal yakalama programı</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">

    <!-- TradingView -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #121212; /* Siyah tonları */
            margin: 0; 
            padding: 0;
            color: #ddd; /* Açık gri metin rengi */
            background: radial-gradient(ellipse at bottom, #0d1d31 0%, #0c0d13 100%);
        }
        /* HEADER */
        header {
            background: #0c1421; /* Koyu arka plan */
            border-bottom: 1px solid #444;
            padding: 0 20px;
            height: 60px; /* Header yüksekliği */
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        header .header-left h1 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 600;
            color: #fff; /* Beyaz renk başlık için */
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .header-right a {
            text-decoration: none;
            color: #009f04; /* Yeşil link rengi */
            font-weight: 500;
        }
        .header-right .welcome {
            color: #fff; /* Beyaz renk */
            font-weight: 500;
        }

        /* CONTAINER */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        form label {
            font-weight: 500;
            color: #ddd; /* Açık gri metin rengi */
        }
        .select2-container .select2-selection--single {
            height: 40px !important;
            border: 1px solid #009f04 !important; /* Yeşil sınır */
            border-radius: 5px !important;
            background: #333 !important; /* Koyu arka plan */
            color: #fff; /* Beyaz metin */
        }
        .select2-results { background-color: #1c1c1c; }
        .select2-search input { background-color: #1c1c1c; }
        .select2-search { background-color: #1c1c1c; }
        .select2-container--default .select2-selection--single .select2-selection__rendered { color: #009f04; }
        button {
            background: #009f04; /* Yeşil arka plan */
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            font-weight: 500;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.9;
        }

        .info-text {
            margin-bottom: 20px;
            line-height: 1.6;
            background: #333; /* Koyu arka plan */
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #444;
        }
        .info-text strong {
            color: #009f04; /* Yeşil metin rengi */
        }

        .tv-chart-container {
            background: #333; /* Koyu arka plan */
            border: 1px solid #009f04;
            border-radius: 5px;
            margin-bottom: 20px;
            height: 600px;
        }
        .tradingview-widget-container {
            position: relative;
            height: 100%;
        }
        #tradingview_chart {
            width: 100%;
            height: 100%;
        }

        .signal-card {
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            color: #ddd; /* Açık gri metin rengi */
            position: relative;
            background: #444; /* Koyu arka plan */
            border:1px solid #555;
        }

        .signal-buy {
            border: 0px solid #28a745;
            background: #004d00; /* Koyu yeşil arka plan */
        }
        .signal-sell {
            border: 0px solid #dc3545;
            background: #660000; /* Koyu kırmızı arka plan */
        }
        .signal-hold {
            border: 0px solid #ffc107;
            background: #4d4d00; /* Koyu sarı arka plan */
        }

        .signal-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin:0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-icon {
            width:15px; 
            height:15px; 
            border-radius:50%;
            display:inline-block;
        }
        .legend-buy {
            background:#28a745;
        }
        .legend-sell {
            background:#dc3545;
        }
        .legend-hold {
            background:#ffc107;
        }

        .signal-description {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom:20px;
        }

        .legend {
            display: flex;
            gap: 10px;
            align-items:center;
            margin: 20px 0;
        }

        .legend span {
            display:flex;
            align-items:center;
            gap:5px;
            font-size:0.9rem;
        }

        .details-toggle {
            background:none;
            border:none;
            color:#009f04;
            font-weight:500;
            cursor:pointer;
            padding:0;
            text-decoration:underline;
            margin-bottom:10px;
        }
        .details-toggle:hover {
            opacity:0.8;
        }

        .details-section {
            overflow:hidden;
            max-height:0;
            opacity:0;
            transition: all 0.3s ease;
            white-space: pre-line;
            margin-bottom:0;
        }

        .details-section.open {
            max-height:500px;
            opacity:1;
            padding-top:10px;
        }

        .details-section h3 {
            margin-top:0;
            color:#fff;
            font-weight:600;
            margin-bottom:10px;
        }

        /* Preloader */
        #preloader {
            display:none;
            position: fixed;
            top:0; left:0; 
            width:100vw; 
            height:100vh; 
            background: rgba(0,0,0,0.8); /* Siyah arka plan */
            display:flex; 
            flex-direction:column;
            align-items:center; 
            justify-content:center; 
            z-index:9999;
            color:#fff;
            font-weight:500;
            font-size:1.1rem;
        }
        .spinner {
            border: 6px solid #f3f3f3; 
            border-top: 6px solid #009f04; 
            border-radius: 50%; 
            width: 50px; 
            height: 50px; 
            animation: spin 1s linear infinite;
            margin-bottom:10px;
        }
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .signals-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        .signals-table th {
            background-color: #009f04; /* Yeşil başlık */
            color: white;
            padding: 12px;
        }
        .signals-table td {
            padding: 2px;
            border-bottom: 1px solid #555;
            text-align: center;
}
        
        .signals-table tr:hover {
            background-color: #333;
        }
        .signal-badge {
            display: inline-block;
            width: 80%;  /* Genişlik %80 */
            text-align: center;
            padding: 10px 0;
            border-radius: 5px;
            font-weight: bold;
            color: white;
        }
        .buy {
            background-color: #28a745;
            color: white;
        }
        .sell {
            background-color: #dc3545;
            color: white;
        }
        .hold {
            background-color: #ffc107;
            color: white;
        }
/* Orbitron fontunu eklemek için Google Fonts'tan çağırma */
    @import url('https://fonts.googleapis.com/css2?family=Orbitron&display=swap');

    .torypto {
        font-family: 'Orbitron', sans-serif; /* Orbitron fontu */
        font-size: 18px; /* Font büyüklüğü 18px */
        color: white; /* Beyaz renk */
        margin: 0;
    }
            .slider-container {
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            background-color: #0c1421;
            padding: 10px 0;
        }
        .slider {
            display: inline-flex;
            animation: slide 30s linear infinite;
        }
        .parite {
            display: flex;
            align-items: center;
            margin: 0 20px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }
        .icon {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .buy { background-color: #28a745; }
        .sell { background-color: #dc3545; }
        .hold { background-color: #ffc107; }
        @keyframes slide {
            from { transform: translateX(0%); }
            to { transform: translateX(-100%); }
        }
.pair-box {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 10px 30px;
    border-bottom: 1px solid rgba(0, 255, 100, 0.2);
    background: #051129;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    border-radius: 8px;
    box-sizing: border-box;
}

.pair-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.pair-icon {
    width: 40px;
    height: 40px;
    object-fit: contain;
    border-radius: 50%;
    background: #2b2b2b;
    border: 2px solid #009f04;
}

.pair-name {
    font-size: 1.4rem;
    font-weight: 600;
    color: #00ff88;
}

.live-price {
    font-size: 1.6rem;
    font-weight: 700;
    color: #ffffff;
}


    </style>
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="header-left">
    <h1 class="torypto">torypto</h1>
</div>
        <div class="header-right">
            {% if user.is_authenticated %}
                <span class="welcome">Merhaba, {{ user.username }}!</span>
                <a href="{% url 'logout' %}">Çıkış</a>
            {% else %}
                <a href="{% url 'login' %}">Giriş Yap</a>
            {% endif %}
        </div>
    </header>
    <div class="slider-container">
        <div class="slider" id="slider">
            <!-- Parite Verileri -->
        </div>
    </div>
    <!-- Preloader -->
    <div id="preloader">
        <div class="spinner"></div>
        Analiz yapılıyor, lütfen bekleyin...
    </div>

    <div class="container">
    
        <!-- Parite Seçimi -->
        <form method="get" action="">
            <label for="pair">Parite Seç:</label>
            <select name="pair" id="pair" style="width: 300px;     background-color: #000;">
                {% for pair in pairs %}
                    <option value="{{ pair }}" {% if pair == selected_pair %}selected{% endif %}>{{ pair }}</option>
                {% endfor %}
            </select>
            <button type="submit">Analiz Yap</button>
        </form>

        <!-- Canlı Fiyat / Seçili Parite Bilgisi -->
<div class="pair-box">
    <div class="pair-info">
        <img src="https://www.binance.com/static/images/common/empty.svg" id="pair-icon" alt="Parite" class="pair-icon">
        <span class="pair-name">{{ selected_pair }}</span>
    </div>
    <div class="live-price">
        💹 <span id="live-price">{{ live_price }}</span>
    </div>
</div>

        <!-- Sinyal Kartı -->
        {% if signal == "Buy" %}
        <div class="signal-card signal-buy">
            <div class="signal-title">
                <span class="legend-icon legend-buy"></span> Al Sinyali
            </div>
            <div class="signal-description">
                Piyasa şu an yukarı yönlü bir eğilimde görünüyor. Bu, alım fırsatı olabileceğini gösteriyor.
            </div>
            <button type="button" class="details-toggle" id="details-btn">Detay Göster</button>
            <div class="details-section" id="details-section">
                <h3>Detaylı İnceleme</h3>
                {{ comment }}
            </div>
        </div>
        {% elif signal == "Sell" %}
        <div class="signal-card signal-sell">
            <div class="signal-title">
                <span class="legend-icon legend-sell"></span> Sat Sinyali
            </div>
            <div class="signal-description">
                Piyasa şu an aşağı yönlü bir eğilimde. Elinizde varsa, satış yaparak kârı realize etmek mantıklı olabilir.
            </div>
            <button type="button" class="details-toggle" id="details-btn">Detay Göster</button>
            <div class="details-section" id="details-section">
                <h3>Detaylı İnceleme</h3>
                {{ comment }}
            </div>
        </div>
        {% else %}
        <div class="signal-card signal-hold">
            <div class="signal-title">
                <span class="legend-icon legend-hold"></span> Bekle Sinyali
            </div>
            <div class="signal-description">
                Piyasa kararsız veya net bir yönü yok. Yeni bir işlem açmadan önce durumu izlemek mantıklı olabilir.
            </div>
            <button type="button" class="details-toggle" id="details-btn">Detay Göster</button>
            <div class="details-section" id="details-section">
                <h3>Detaylı İnceleme</h3>
                {{ comment }}
            </div>
        </div>
        {% endif %}
        <!-- Legend (açıklama) -->
        <div class="legend">
            <span><div class="legend-icon legend-buy"></div> Alım yönü</span>
            <span><div class="legend-icon legend-sell"></div> Satış yönü</span>
            <span><div class="legend-icon legend-hold"></div> Bekle</span>
        </div>
<h3>Sinyal Listesi</h3><span>Son 15 parite görüntülenmektedir.</span>
<table class="signals-table">
    <thead>
        <tr>
            <th>Parite</th>
            <th>Sinyal</th>
            <th>Zaman Dilimi</th>
            <th>Güncellenme Tarihi</th>
        </tr>
    </thead>
   <tbody>
    {% for signal in signals %}
    <tr {% if signal.pair == selected_pair %} style="background-color: #333;" {% endif %}>
        <td>{{ signal.pair }}</td>
        <td class="signal-{{ signal.signal|lower }}">
            {% if signal.signal == 'Buy' %}
                <span class="signal-badge buy">Al</span>
            {% elif signal.signal == 'Sell' %}
                <span class="signal-badge sell">Sat</span>
            {% else %}
                <span class="signal-badge hold">Bekle</span>
            {% endif %}
        </td>
        <td>{{ signal.timeframe }}</td>
        <td>{{ signal.updated_at|date:"d F Y, H:i" }}</td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="6">Henüz sinyal yok.</td>
    </tr>
    {% endfor %}
</tbody>

</table>

        <!-- TradingView Grafiği -->
        <div class="tv-chart-container tradingview-widget-container">
            <div id="tradingview_chart"></div>
        </div>
        {% with symbol_upper=selected_pair|upper %}
        {% with tv_symbol='BINANCE:'|add:symbol_upper %}
        
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                new TradingView.widget({
                    "width": "100%",
                    "height": "600",
                    "symbol": "{{ tv_symbol }}",
                    "interval": "60",
                    "timezone": "Etc/UTC",
                    "theme": "dark", /* Dark tema */
                    "style": "1",
                    "locale": "tr",
                    "toolbar_bg": "#121212", /* Koyu arka plan */
                    "enable_publishing": false,
                    "allow_symbol_change": true,
                    "hide_legend": false,
                    "save_image": false,
                    "container_id": "tradingview_chart"
                });
            });
        </script>
        {% endwith %}
        {% endwith %}

    </div>

    <!-- JS Kütüphaneleri -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function() {
            // Parite arama kutusu
            $('#pair').select2({
                placeholder: "Parite Seç",
                allowClear: true
            });

            // Form submit edilirken preloader aç
            $('form').on('submit', function() {
                $('#preloader').show();
            });
        });

        // Sayfa tamamen yüklendiğinde preloader gizle
        $(window).on('load', function(){
            $('#preloader').hide();
        });

        // Detay göster/gizle fonksiyonu
        document.addEventListener('DOMContentLoaded', function() {
            const detailsBtn = document.getElementById('details-btn');
            const detailsSection = document.getElementById('details-section');
            if(detailsBtn && detailsSection) {
                let isOpen = false;
                detailsBtn.addEventListener('click', function() {
                    isOpen = !isOpen;
                    if(isOpen) {
                        detailsSection.classList.add('open');
                        detailsBtn.textContent = "Detay Gizle";
                    } else {
                        detailsSection.classList.remove('open');
                        detailsBtn.textContent = "Detay Göster";
                    }
                });
            }
        });
    </script>
        <script>
        function updateSignal(pair) {
            fetch(`/api/update-signal/?pair=${pair}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`${pair} için sinyal güncellendi.`);
                        location.reload();
                    } else {
                        alert(`Güncelleme başarısız: ${data.error}`);
                    }
                })
                .catch(error => {
                    console.error('Güncelleme hatası:', error);
                    alert('Bağlantı hatası.');
                });
        }
    </script>
    <script>
        const pariteRows = Array.from(document.querySelectorAll('.signals-table tbody tr'));
        const slider = document.getElementById('slider');
        
        // En güncel 15 pariteyi seçme
        const sortedRows = pariteRows.sort((a, b) => {
            const dateA = new Date(a.cells[3].textContent);
            const dateB = new Date(b.cells[3].textContent);
            return dateB - dateA; // Tarihe göre azalan sırala
        }).slice(0, 20); // Son 15 pariteyi al
        
        sortedRows.forEach(row => {
            const parite = row.cells[0].textContent;
            const sinyalClass = row.cells[1].querySelector('span').classList;
            let colorClass = 'sell';
            
            if (sinyalClass.contains('buy')) {
                colorClass = 'buy';
            } else if (sinyalClass.contains('hold')) {
                colorClass = 'hold';
            }
            
            const pariteItem = document.createElement('div');
            pariteItem.classList.add('parite');
            pariteItem.innerHTML = `<div class="icon ${colorClass}"></div>${parite}`;
            slider.appendChild(pariteItem);
        });

        // Döngü ekle - boşluk olmaması için
        const duplicate = slider.cloneNode(true);
        slider.parentNode.appendChild(duplicate);
    </script>
<script>
document.addEventListener('DOMContentLoaded', async function () {
    const pair = "{{ selected_pair }}".replace('USDT', '').toLowerCase();
    const pairIcon = document.getElementById('pair-icon');

    try {
        // CoinGecko'dan tüm kripto listesi çek
        const response = await fetch('https://api.coingecko.com/api/v3/coins/list');
        const coins = await response.json();
        
        // Pariteyi listeden bul
        const coin = coins.find(c => c.symbol === pair);

        if (coin) {
            const coinData = await fetch(`https://api.coingecko.com/api/v3/coins/${coin.id}`);
            const coinDetails = await coinData.json();
            pairIcon.src = coinDetails.image.large;
        } else {
            // Parite bulunamazsa default class ekle
            pairIcon.src = "https://cdn-icons-png.flaticon.com/512/1828/1828843.png";  // Placeholder ikon
            pairIcon.classList.add('default-icon');
        }
    } catch (error) {
        console.error("Parite resmi yüklenemedi", error);
        pairIcon.src = "https://cdn-icons-png.flaticon.com/512/1828/1828843.png";  // Hata durumunda yedek ikon
        pairIcon.classList.add('default-icon');
    }
});

</script>
    <footer class="footer">
    <p>
        <small>
            Bu platformda sunulan sinyaller, analizler ve tahminler; gelişmiş indikatörler, makine öğrenmesi ve yapay zeka algoritmaları kullanılarak oluşturulmaktadır.  
            Kripto para piyasaları yüksek volatiliteye sahip olup, ani fiyat dalgalanmalarına açıktır.  
            Beklenmeyen ekonomik gelişmeler, jeopolitik olaylar, regülasyon değişiklikleri ve haber akışları, piyasa yönünde ani değişikliklere neden olabilir.  
            Üretilen sinyaller geçmiş veriler ve istatistiksel modeller baz alınarak hazırlanmakta olup, **gelecekte kesinlik arz etmez**.  
            Burada sunulan bilgiler, yalnızca genel bilgilendirme amaçlıdır ve **herhangi bir yatırım tavsiyesi niteliğinde değildir**.  
            Tüm yatırım kararlarınızı kendi araştırmalarınıza, piyasa analizlerinize ve uzman görüşlerine dayanarak vermeniz tavsiye edilir.  
            Bu platformun geliştiricileri ve operatörleri, doğabilecek herhangi bir mali kayıptan sorumlu tutulamaz.
        </small>
    </p>
</footer>

<style>
    .footer {
        text-align: center;
        padding: 20px;
        margin-top: 40px;
        background-color: #333; /* Koyu arka plan */
        border-top: 1px solid #444;
        font-size: 0.85rem;
        color: #ddd; /* Açık gri metin */
    }
    .footer small {
        display: block;
        max-width: 1000px;
        margin: 0 auto;
    }
</style>
</body>
</html>
